<div class="row">
  <% for post in @posts %>
    <div class="col-md-3 col-sm-6">
      <h4>
        <%# find user who created post %>
        <% user = User.find_by({ "id" => post["user_id"] }) %>
        <%# handle any potential bad data where the post is missing a user %>
        <% if user %>
          <%= user["first_name"] %> <%= user["last_name"] %>
        <% else %>
          anonymous
        <% end %>
      </h4>

      <% if post.uploaded_image.attached? %>
        <img src="<%= url_for(post.uploaded_image) %>" class="img-fluid">
      <% else %>
        <img src="<%= post["image"] %>" class="img-fluid">
      <% end %>

      <p><%= post["body"] %></p>

      <h5>Comments</h5>
      <% post.comments.each do |comment| %>
        <p>
          <strong><%= comment.user.first_name %> <%= comment.user.last_name %>:</strong>
          <%= comment.body %>
        </p>
      <% end %>

      <%= form_for([post, post.comments.build]) do |f| %>
        <%= f.label :body, "New Comment" %>
        <%= f.text_area :body %>
        <%= f.submit "Add Comment" %>
      <% end %>
    </div>
  <% end %>
</div>
